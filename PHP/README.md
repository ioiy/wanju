# PHP Server Process Manager & Proxy Runner

这是一个基于 PHP 的轻量级服务器进程管理套件，专为 PaaS 平台（如 Serv00、CT8 等）或共享主机环境设计。它允许用户通过 Web 界面或 URL 触发器来管理、启动、监控后台进程（主要是 Sing-box、Cloudflared Argo 隧道和 Nezha 监控）。

## 📂 文件结构说明

| 文件名 | 功能描述 |
| :--- | :--- |
| `index.php` | **核心控制器**。负责路由分发，处理所有的 URL 请求，提供启动、查询、订阅等接口。 |
| `start.sh` | **启动脚本**。包含核心业务逻辑（配置环境变量、下载核心程序、启动 Sing-box/Argo/Nezha）。 |
| `kill.php` | **进程清理工具**。自动识别当前用户，强制终止该用户下所有卡死或旧的后台进程，用于重置环境。 |
| `check.php` | **环境探针**。检测服务器是否支持 PHP `exec`/`system` 函数，以及是否安装了 Python 或 Node.js。 |
| `.htaccess` | **Apache 配置文件**。用于 URL 重写（将请求转发给 `index.php`）以及保护敏感目录（如 `.tmp`）。 |

## 🚀 部署与使用

1.  **上传文件**：将所有文件上传至网站根目录（`public_html` 或 `www`）。
2.  **设置权限**：确保文件权限设置正确（建议 `.sh` 文件给予 `755` 权限）。
3.  **配置变量**：修改 `start.sh` 头部的环境变量（`UUID`, `NEZHA_SERVER` 等）以适配你的配置。

## 🔗 功能接口详解 (URL 路由)

所有功能均通过访问 `http://你的域名/后缀` 触发。以下是基于 `index.php` 和 `.htaccess` 逻辑的详细说明：

| 域名后缀 (Route) | 对应功能 | 详细说明 |
| :--- | :--- | :--- |
| `/` <br> *(根路径)* | **存活检测** | 访问根域名，返回 `Hello world`。<br>用于确认 PHP 解析是否正常，或作为保活监控的端点。 |
| `/status` | **状态监控与保活** | **⚠️ 最核心接口**。检查关键进程（Cloudflared, Sing-box, Nezha）是否运行。<br>❌ **未运行**：自动触发启动脚本。<br>✅ **运行中**：返回 "All services are running"。<br>💡 **建议**：配合定时任务（Cron）每 5 分钟访问一次。 |
| `/start` | **启动服务** | 强制调用 `start.sh` 脚本。<br>如果服务未运行，它会下载核心、生成配置并启动所有服务。 |
| `/restart` | **重启服务** | 功能同 `/start`。<br>逻辑上用于强制重新执行启动脚本（注：建议先执行 `/kill.php` 再访问此接口）。 |
| `/sub` | **获取订阅** | 读取 `.tmp/sub.txt` 文件内容并输出。<br>这是你的节点订阅链接内容，通常配合 V2rayN 或 Clash 使用。 |
| `/check` | **环境诊断** | 加载 `check.php`。<br>以图形化界面显示服务器环境信息（PHP 函数禁用情况、Python/Node 版本等）。 |
| `/list` | **进程列表** | 执行 `ps aux` 命令。<br>打印当前服务器上所有的进程列表，用于调试和查看系统负载。 |

## 🛠️ 特殊功能文件

此文件独立于路由逻辑之外，需直接访问文件名：

### `/kill.php`：进程清理工具
* **访问地址**：`http://你的域名/kill.php`
* **作用**：当服务卡死或需要更新配置时，先访问此链接清理所有旧进程。

## 💡 建议操作流程

1.  **初次部署/修改配置后**：
    * 先访问 `/kill.php` (清理环境)
    * 再访问 `/start` (启动服务)
2.  **日常维护**：
    * 设置定时监控（UptimeRobot 或 Cron）访问 `/status` 进行保活。
3.  **使用节点**：
    * 访问 `/sub` 获取节点订阅链接。

## ⚠️ 注意事项

* 本项目依赖 PHP 的 `exec`, `shell_exec`, `passthru` 等函数，请确保主机未禁用这些函数。
* `start.sh` 会自动生成配置文件并保存在 `.tmp` 目录下，**请勿手动删除该目录**。
